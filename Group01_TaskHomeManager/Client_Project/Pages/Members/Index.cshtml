@page
@model dynamic
@{
    ViewData["Title"] = "Thành viên gia đình";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Thành viên gia đình</h3>
        <a href="/Members/Add" class="btn btn-primary">
            <i class="bi bi-person-plus"></i> Thêm thành viên
        </a>
    </div>

    <div id="memberList" class="row g-3"></div>
</div>

<script>
    async function loadMembers() {
        const token = localStorage.getItem("token");
        const res = await fetch("https://localhost:7145/api/FamilyMembers/myfamily", {
            headers: { "Authorization": `Bearer ${token}` }
        });

        const data = await res.json();
        const container = document.getElementById("memberList");
        container.innerHTML = "";

        data.forEach(m => {
            container.innerHTML += `
                <div class="col-md-4">
                    <div class="card p-3 shadow-sm">
                        <div class="d-flex align-items-center">
                            <div class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center me-3"
                                 style="width:48px;height:48px;font-weight:600;font-size:18px;">
                                 ${m.fullName.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h6 class="mb-0">${m.fullName}</h6>
                                <small class="text-muted">${m.relationship}</small>
                            </div>
                        </div>
                        <a href="/Members/Edit?memberId=${m.memberId}" class="btn btn-outline-primary w-100 mt-3">
                            <i class="bi bi-pencil-square"></i> Chỉnh sửa
                        </a>
                    </div>
                </div>
            `;
        });
    }
    loadMembers();
</script>
