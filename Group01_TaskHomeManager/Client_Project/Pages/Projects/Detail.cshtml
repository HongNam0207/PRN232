@page
@model dynamic
@{
    ViewData["Title"] = "Chi tiết dự án";
}
<div class="container mt-4">
    <h3 id="projectName"></h3>
    <p id="projectDesc" class="text-muted"></p>

    <a href="/Tasks/Create" class="btn btn-primary mb-3">+ Thêm công việc</a>

    <div id="taskList" class="row g-3"></div>
</div>

<script>
    const id = new URLSearchParams(location.search).get("projectId");
    const token = localStorage.getItem("token");

    async function load(){
        const res = await fetch(`/api/Projects`, { headers: { Authorization:`Bearer ${token}` }});
        const all = await res.json();
        const p = all.find(x=>x.projectId==id);
        projectName.innerText = p.projectName;
        projectDesc.innerText = p.description;

        const t = await fetch(`/api/Tasks/family`, { headers: { Authorization:`Bearer ${token}` }});
        const tasks = await t.json();
        taskList.innerHTML = tasks.map(x=>`
          <div class="col-md-4">
            <div class="card p-3 shadow-sm">
              <h5>${x.title}</h5>
              <p>${x.status}</p>
              <a href="/Tasks/Detail?taskId=${x.taskId}" class="btn btn-outline-primary w-100">Xem</a>
            </div>
          </div>`).join("");
    }
    load();
</script>
