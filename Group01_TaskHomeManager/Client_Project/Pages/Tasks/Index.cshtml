@page
@model dynamic
@{
    ViewData["Title"] = "Công việc";
}
<div class="container mt-4">
    <h3 class="mb-3">Công việc trong gia đình</h3>
    <a href="/Tasks/Create" class="btn btn-primary mb-4">+ Thêm công việc</a>

    <div class="row">
        <div class="col-md-4"><h5>Chờ xử lý</h5><div id="pending"></div></div>
        <div class="col-md-4"><h5>Đang thực hiện</h5><div id="doing"></div></div>
        <div class="col-md-4"><h5>Hoàn thành</h5><div id="done"></div></div>
    </div>
</div>

<script>
    async function load(){
     const token = localStorage.getItem("token");
     const res = await fetch("/api/Tasks/family",{ headers:{Authorization:`Bearer ${token}`}});
     const tasks = await res.json();
     const add=(id,t)=>document.getElementById(id).innerHTML+=`
       <div class="card p-3 shadow-sm mb-3">
         <h6>${t.title}</h6>
         <small>${t.assignedUserNames.join(', ')}</small>
         <a href="/Tasks/Detail?taskId=${t.taskId}" class="btn btn-outline-primary w-100 mt-2">Xem</a>
       </div>`;
     tasks.forEach(t=>add(
       t.status=="Pending"?"pending":t.status=="In Progress"?"doing":"done",t
     ));
    }
    load();
</script>
