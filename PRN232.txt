-- ===========================
-- DATABASE: HomeTaskManagementDB
-- ===========================
CREATE DATABASE HomeTaskManagementDB;
GO
USE HomeTaskManagementDB;
GO

-- ===========================
-- 1. Roles
-- ===========================
CREATE TABLE Roles (
    RoleId INT IDENTITY(1,1) PRIMARY KEY,
    RoleName NVARCHAR(50) NOT NULL
);

-- ===========================
-- 2. Users
-- ===========================
CREATE TABLE Users (
    UserId INT IDENTITY(1,1) PRIMARY KEY,
    FullName NVARCHAR(100),
    Email NVARCHAR(100) UNIQUE NOT NULL,
    PasswordHash NVARCHAR(255) NOT NULL,
    RoleId INT FOREIGN KEY REFERENCES Roles(RoleId),
    PhoneNumber NVARCHAR(20),
    CreatedAt DATETIME DEFAULT GETDATE(),
    IsActive BIT DEFAULT 1
);

-- ===========================
-- 3. Families
-- ===========================
CREATE TABLE Families (
    FamilyId INT IDENTITY(1,1) PRIMARY KEY,
    FamilyCode NVARCHAR(20) UNIQUE,  -- ‚úÖ Gi·ªØ c·ªôt m√£ code
    FamilyName NVARCHAR(100),
    Address NVARCHAR(200),
    CreatedBy INT FOREIGN KEY REFERENCES Users(UserId),
    CreatedAt DATETIME DEFAULT GETDATE()
);

-- ===========================
-- 4. Family Members
-- ===========================
CREATE TABLE FamilyMembers (
    MemberId INT IDENTITY(1,1) PRIMARY KEY,
    FamilyId INT FOREIGN KEY REFERENCES Families(FamilyId),
    UserId INT FOREIGN KEY REFERENCES Users(UserId),
    Relationship NVARCHAR(50),
    JoinDate DATETIME DEFAULT GETDATE()
);

-- ===========================
-- 5. Projects
-- ===========================
CREATE TABLE Projects (
    ProjectId INT IDENTITY(1,1) PRIMARY KEY,
    FamilyId INT FOREIGN KEY REFERENCES Families(FamilyId),
    ProjectName NVARCHAR(200) NOT NULL,
    Description NVARCHAR(MAX),
    StartDate DATETIME DEFAULT GETDATE(),
    EndDate DATETIME NULL,
    CreatedBy INT FOREIGN KEY REFERENCES Users(UserId),
    CreatedAt DATETIME DEFAULT GETDATE()
);

-- ===========================
-- 6. Tasks
-- ===========================
CREATE TABLE Tasks (
    TaskId INT IDENTITY(1,1) PRIMARY KEY,
    FamilyId INT FOREIGN KEY REFERENCES Families(FamilyId),
    ProjectId INT NULL FOREIGN KEY REFERENCES Projects(ProjectId),
    Title NVARCHAR(200),
    Description NVARCHAR(MAX),
    Priority NVARCHAR(20),
    Status NVARCHAR(20) DEFAULT 'Pending',
    CreatedBy INT FOREIGN KEY REFERENCES Users(UserId),
    CreatedAt DATETIME DEFAULT GETDATE(),
    DueDate DATETIME,
    UpdatedAt DATETIME NULL
);

-- ===========================
-- 7. Task Assignments
-- ===========================
CREATE TABLE TaskAssignments (
    AssignmentId INT IDENTITY(1,1) PRIMARY KEY,
    TaskId INT FOREIGN KEY REFERENCES Tasks(TaskId),
    UserId INT FOREIGN KEY REFERENCES Users(UserId),
    AssignedAt DATETIME DEFAULT GETDATE(),
    CompletedAt DATETIME NULL,
    ProgressNote NVARCHAR(MAX),
    ProgressPercent INT DEFAULT 0
);

-- ===========================
-- 8. Comments
-- ===========================
CREATE TABLE Comments (
    CommentId INT IDENTITY(1,1) PRIMARY KEY,
    TaskId INT FOREIGN KEY REFERENCES Tasks(TaskId),
    UserId INT FOREIGN KEY REFERENCES Users(UserId),
    Content NVARCHAR(MAX),
    CreatedAt DATETIME DEFAULT GETDATE(),
    ParentCommentId INT NULL
);

-- ===========================
-- 9. Rewards
-- ===========================
CREATE TABLE Rewards (
    RewardId INT IDENTITY(1,1) PRIMARY KEY,
    UserId INT FOREIGN KEY REFERENCES Users(UserId),
    Points INT DEFAULT 0,
    Badge NVARCHAR(100) NULL,
    EarnedAt DATETIME DEFAULT GETDATE(),
    Description NVARCHAR(255) NULL
);

-- ===========================
-- 10. Attachments
-- ===========================
CREATE TABLE Attachments (
    AttachmentId INT IDENTITY(1,1) PRIMARY KEY,
    TaskId INT FOREIGN KEY REFERENCES Tasks(TaskId),
    FileUrl NVARCHAR(255) NOT NULL,
    UploadedBy INT FOREIGN KEY REFERENCES Users(UserId),
    UploadedAt DATETIME DEFAULT GETDATE(),
    FileType NVARCHAR(50) NULL
);
GO

-- ===========================
-- üå± D·ªÆ LI·ªÜU M·∫™U
-- ===========================
INSERT INTO Roles (RoleName) VALUES (N'Admin'), (N'Member');

INSERT INTO Users (FullName, Email, PasswordHash, RoleId, PhoneNumber)
VALUES
(N'Nguy·ªÖn Qu·∫£n Tr·ªã', 'admin@gmail.com', '123456', 1, '0911111111'),
(N'Nguy·ªÖn H·ªìng Nam', 'nam@gmail.com', '123456', 2, '0988888888'),
(N'L√™ Th√πy Dung', 'dung@gmail.com', '123456', 2, '0977777777'),
(N'Ph·∫°m Qu·ªëc Huy', 'huy@gmail.com', '123456', 2, '0966666666');

INSERT INTO Families (FamilyCode, FamilyName, Address, CreatedBy)
VALUES
('FAM001', N'Gia ƒë√¨nh Nguy·ªÖn', N'H√† N·ªôi', 2),
('FAM002', N'Gia ƒë√¨nh L√™', N'H·ªì Ch√≠ Minh', 3);

INSERT INTO FamilyMembers (FamilyId, UserId, Relationship)
VALUES
(1, 2, N'Ch·ªß gia ƒë√¨nh'),
(1, 3, N'V·ª£'),
(1, 4, N'Con trai'),
(2, 3, N'Ch·ªß gia ƒë√¨nh');

INSERT INTO Projects (FamilyId, ProjectName, Description, CreatedBy)
VALUES
(1, N'D·ªçn d·∫πp nh√† c·ª≠a T·∫øt', N'T·ªïng v·ªá sinh to√†n b·ªô nh√† tr∆∞·ªõc T·∫øt', 2),
(1, N'Tr·ªìng c√¢y s√¢n v∆∞·ªùn', N'C·∫£i t·∫°o khu v∆∞·ªùn sau nh√†', 3);

INSERT INTO Tasks (FamilyId, ProjectId, Title, Description, Priority, Status, CreatedBy, DueDate)
VALUES
(1, 1, N'D·ªçn ph√≤ng kh√°ch', N'Lau ch√πi, h√∫t b·ª•i, s·∫Øp x·∫øp b√†n gh·∫ø', 'High', 'Pending', 2, '2025-11-10'),
(1, 1, N'R·ª≠a xe m√°y', N'R·ª≠a xe c·ªßa b·ªë v√† m·∫π', 'Medium', 'Doing', 3, '2025-11-09'),
(1, 2, N'Tr·ªìng c√¢y m·ªõi', N'Mua c√¢y hoa gi·∫•y v√† tr·ªìng ·ªü s√¢n', 'Low', 'Pending', 4, '2025-11-15');

INSERT INTO TaskAssignments (TaskId, UserId, ProgressPercent)
VALUES
(1, 2, 30),
(1, 3, 50),
(2, 4, 80),
(3, 2, 10);

INSERT INTO Comments (TaskId, UserId, Content)
VALUES
(1, 2, N'Anh s·∫Ω l√†m ph·∫ßn s·∫Øp x·∫øp t·ªß tr∆∞·ªõc.'),
(1, 3, N'Em s·∫Ω lau k√≠nh v√† b√†n.'),
(2, 4, N'Xe m·∫π h∆°i b·∫©n, con s·∫Ω r·ª≠a tr∆∞·ªõc.'),
(3, 2, N'ƒê√£ mua c√¢y v·ªÅ, chu·∫©n b·ªã tr·ªìng.');

INSERT INTO Rewards (UserId, Points, Badge, Description)
VALUES
(2, 50, N'HƒÉng h√°i', N'Ho√†n th√†nh c√¥ng vi·ªác ƒë·∫ßu ti√™n.'),
(3, 100, N'Ng∆∞·ªùi chƒÉm ch·ªâ', N'Th·ª±c hi·ªán nhi·ªÅu c√¥ng vi·ªác trong th√°ng.'),
(4, 20, N'T√¢n binh', N'Tham gia d·ª± √°n ƒë·∫ßu ti√™n.');

INSERT INTO Attachments (TaskId, FileUrl, UploadedBy, FileType)
VALUES
(1, N'https://example.com/image1.jpg', 2, N'Image'),
(3, N'https://example.com/garden-plan.pdf', 3, N'PDF');
GO
